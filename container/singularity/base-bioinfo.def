Bootstrap: docker
From: gaow/base-notebook

%labels
maintainer="Hao Sun<hs3163@cumc.columbia.edu>"
%post

# Maintainer and author

# This docker image contains basic bioinfo tools that are used in the data_preprocessing stage of the xqtl pipeline

su -  root # USER root

## Tidyverse
R --slave -e "install.packages(c('rlang','tidyverse','BiocManager', 'RcppEigen'))"

# Genotype

## GWAS_QC

### PLINK

wget http://s3.amazonaws.com/plink1-assets/plink_linux_x86_64_20200616.zip && \
unzip plink_linux_x86_64_20200616.zip && mv plink /usr/local/bin
    
### PLINK2

wget https://s3.amazonaws.com/plink2-assets/plink2_linux_avx2_20211217.zip && \
unzip plink2_linux_avx2_20211217.zip && mv plink2 /usr/local/bin
    
### igraph
R --slave -e "install.packages('igraph')"

## GRM
### GCTA

wget https://cnsgenomics.com/software/gcta/bin/gcta_1.93.2beta.zip && \
unzip gcta_1.93.2beta.zip && mv gcta_1.93.2beta/gcta64 /usr/local/bin
## LD
### PLINK (satisfied)

# Phenotype
## Normalization
### QTL packages

pip install qtl

### BCFTOOLS
wget https://github.com/samtools/bcftools/releases/download/1.2/bcftools-1.2.tar.bz2\
&& tar xvf bcftools-1.2.tar.bz2 \
&& cd bcftools-1.2 \
&& make\
&& make install\
&& cd htslib-1.2.1\
&& make\
&& make install

rm -rf bcftools-1.2 \
&& rm -rf bcftools-1.2.tar.bz2
 
## annotation
R --slave -e "BiocManager::install('biomaRt')"

## Phenotype_formatting & Residual
### bcftools(satisfied)

# Covariate
## See container APEX, PEER, and flashpca

# sumstat_merger
R --slave -e "BiocManager::install('VariantAnnotation')"
pip install Biopython


# to build singularity build --remote ./ 

%runscript
exec /bin/bash "$@"
%startscript
exec /bin/bash "$@"
